// Prisma schema for Job Application Auto-Fill Extension

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String         @id @default(uuid())
  email         String         @unique
  password      String
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  profile       Profile?
  unknownFields UnknownField[]
}

model Profile {
  id        String   @id @default(uuid())
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Personal Information
  firstName       String?
  lastName        String?
  email           String?
  phone           String?
  address         String?
  city            String?
  state           String?
  zipCode         String?
  country         String?

  // Professional Information
  currentJobTitle String?
  currentCompany  String?
  linkedinUrl     String?
  portfolioUrl    String?
  githubUrl       String?

  // Work Authorization
  workAuthorization    String?  // e.g., "US Citizen", "Green Card", "H1B", etc.
  willingToRelocate    Boolean  @default(false)
  salaryExpectation    String?
  availableStartDate   String?

  // Education
  degree               String?
  university           String?
  fieldOfStudy         String?
  gpa                  String?
  educationStartMonth  String?  // e.g., "09" for September
  educationStartYear   String?  // e.g., "2018"
  educationEndMonth    String?  // e.g., "05" for May
  educationEndYear     String?  // e.g., "2022"
  graduationYear       String?  // Legacy field, keep for compatibility

  // Work Experience
  yearsOfExperience    String?
  // Current/Most Recent Job
  jobTitle             String?
  companyName          String?
  workStartMonth       String?  // e.g., "01" for January
  workStartYear        String?  // e.g., "2020"
  workEndMonth         String?  // e.g., "12" for December (leave empty if current)
  workEndYear          String?  // e.g., "2023" (leave empty if current)
  isCurrentJob         Boolean  @default(false)
  jobDescription       String?  // Description of responsibilities

  // Skills & Summary
  skills            String?  // Comma-separated skills
  softSkills        String?  // Comma-separated soft skills
  languages         String?  // Languages with proficiency
  certifications    String?  // Professional certifications
  summary           String?  // Professional summary/objective

  // Resume & Cover Letter
  resumeFileName    String?
  resumeData        String?  // Base64 encoded resume or URL
  coverLetter       String?  // Default cover letter text
}


model UnknownField {
  id          String   @id @default(uuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  fieldName   String   // The name/id attribute of the field
  fieldLabel  String?  // Human-readable label if detected
  fieldType   String   // input, select, textarea, etc.
  placeholder String?  // Placeholder text if any
  pageUrl     String   // URL where the field was found
  pageDomain  String   // Domain for grouping
  
  userValue   String?  // Value provided by user for this field
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([userId, fieldName, pageDomain])
}
